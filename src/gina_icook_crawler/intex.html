<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>é¤µé£Ÿç¢³æ’å°å¹«æ‰‹</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ===== å…¨åŸŸè¨­å®š ===== */
body {
    font-family: "Noto Sans TC", sans-serif;
    background: #e8f4f3;
    margin: 0;
    padding: 0;
    position: relative;

    /* ğŸŒ¥ï¸ æ·¡æ·¡çš„é›²æœµèƒŒæ™¯åœ–ï¼ˆä¸å¹²æ“¾å…§å®¹ï¼‰ */
    background-image: url('https://raw.githubusercontent.com/chunheart/assets/main/cloud_bg_soft.png');
    background-size: 450px;
    background-repeat: repeat;
    background-attachment: fixed;
    opacity: 0.97;
}

/* NAV å°è¦½åˆ— */
.navbar {
    display: flex;
    background: #0fa3a1;
    color: white;
    padding: 14px 20px;
    gap: 20px;
    font-size: 18px;
}
.navItem {
    cursor: pointer;
    padding: 6px 12px;
    border-radius: 6px;
    transition: 0.2s;
}
.navItem:hover {
    background: rgba(255,255,255,0.35);
}
.activeTab {
    background: rgba(255,255,255,0.45);
}

/* å€å¡Šå®¹å™¨ */
.page {
    display: none;
    max-width: 1100px;
    margin: auto;
    padding: 30px;
}

/* å¡ç‰‡å€å¡Šï¼ˆæ›´å¯æ„›ï¼‰ */
.section {
    background: white;
    padding: 25px;
    border-radius: 16px;
    margin-top: 20px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    animation: fadeUp 0.6s ease;
}

/* è¡¨æ ¼ */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    border-radius: 12px;
    overflow: hidden;
}
th, td {
    padding: 12px;
    border-bottom: 1px solid #eee;
    text-align: center;
}
th {
    background: #f1faf8;
    font-weight: 700;
}

/* æ·¡å…¥å‹•ç•« */
@keyframes fadeUp {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* é£Ÿè­œå°é¢åœ– + spinner */
.previewImgMain {
    width: 180px;
    height: 140px;
    border-radius: 12px;
    object-fit: cover;
    opacity: 0;
    transition: opacity 0.6s ease-in-out;
    position: relative;
}

.spinner {
    border: 4px solid rgba(255,255,255,0.3);
    border-top: 4px solid #0fa3a1;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    animation: spin 1s linear infinite;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* ===== ICON Aâ€“E å¯æ„›è·³å‹•å‹•ç•« ===== */
.icon-bounce {
    animation: bounce 1.8s infinite ease-in-out;
}
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
}

/* ===== ğŸŒ å°åœ°çƒå°åŠ©æ‰‹ ===== */
.helper-wrap {
    position: fixed;
    right: 26px;
    bottom: 26px;
    z-index: 9999;
    cursor: pointer;
}

.helper-img {
    width: 90px;
    height: 90px;
    animation: sway 2.4s infinite ease-in-out;
}

/* å·¦å³æ–æ“ºå‹•ç•« */
@keyframes sway {
    0%   { transform: rotate(-4deg); }
    50%  { transform: rotate(4deg); }
    100% { transform: rotate(-4deg); }
}

/* æç¤ºæ³¡æ³¡ï¼ˆå°åŠ©æ‰‹é ­ä¸Šæ–¹ï¼‰ */
.helper-bubble {
    position: absolute;
    right: 80px;
    bottom: 70px;
    background: white;
    padding: 12px 18px;
    border-radius: 12px;
    font-size: 16px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.15);
    display: none;
    animation: fadeUp 0.3s ease;
}
</style>
</head>

<body>

<!-- å°è¦½åˆ— -->
<div class="navbar">
    <div class="navItem activeTab" onclick="showPage(event,'recipe')">ğŸ¥— é¤µé£Ÿç¢³æ’å°å¹«æ‰‹</div>
    <div class="navItem" onclick="showPage(event,'about')">â„¹ï¸ é—œæ–¼é¤µé£Ÿç¢³æ’å°å¹«æ‰‹</div>
</div>

<!-- ğŸ€ å°åœ°çƒå°åŠ©æ‰‹ï¼ˆå³ä¸‹è§’æ¼‚æµ®ï¼‰ -->
<div class="helper-wrap" onclick="toggleBubble()">
    <img src="earth_helper.png" class="helper-img">
    <div id="helperBubble" class="helper-bubble">è«‹é¤µé£Ÿ ğŸ½ï¸</div>
</div>

<script>
function toggleBubble() {
    let b = document.getElementById("helperBubble");
    b.style.display = (b.style.display === "block") ? "none" : "block";
}
</script>
<!-- ======================== é£Ÿè­œç¢³æ’åˆ†æé  ======================== -->
<div id="page_recipe" class="page" style="display:block;">

    <!-- åŒ¯å…¥å€å¡Š -->
    <div class="section">
        <h2>ğŸ“¥ åŒ¯å…¥ CSVï¼ˆå¯å¤šä»½ï¼‰</h2>
        <input type="file" id="csvFile" accept=".csv" multiple>
        <br><br>

        <button onclick="loadCSV()" 
            style="padding:12px 24px;border:none;border-radius:12px;
                   background:#0fa3a1;color:white;font-size:16px;cursor:pointer;
                   box-shadow:0 3px 8px rgba(0,0,0,0.15);">
            è®€å–å…¨éƒ¨ CSV
        </button>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div id="mainContent" style="display:none;">

        <!-- é£Ÿè­œæ¨™é¡Œå€ -->
        <div class="section" style="display:flex;gap:20px;align-items:flex-start;">
            
            <!-- å°é¢åœ–ç‰‡ -->
            <div style="position:relative;width:180px;height:140px;">
                <div id="imgSpinner" class="spinner" style="display:none;"></div>
                <img id="recipeImage"
                    class="previewImgMain"
                    src="https://images.unsplash.com/photo-1504674900247-0877df9cc836"
                    onerror="this.src='https://images.unsplash.com/photo-1504674900247-0877df9cc836'">
            </div>

            <!-- æ¨™é¡Œ & ä½œè€… -->
            <div>
                <div style="font-size:30px;font-weight:700;color:#145f5a;"
                     id="recipeTitle">é£Ÿè­œåç¨±</div>

                <div id="recipeAuthor"
                     style="color:#888;font-size:18px;margin-top:6px;">ä½œè€…</div>

                <!-- ä¾†æºç¶²å€ -->
                <div id="recipeSource" style="margin-top:18px;"></div>
            </div>
        </div>

        <!-- æœå°‹ + ä¸‹æ‹‰ -->
        <div class="section">
            <h3>ğŸ“‘ é¸æ“‡é£Ÿè­œ</h3>

            <input type="text" id="searchInput" placeholder="æœå°‹é£Ÿè­œ..."
                style="width:100%;padding:12px;border-radius:10px;border:1px solid #bbb;
                       margin-bottom:15px;font-size:16px;"
                oninput="filterRecipes()">

            <select id="recipeSelect" onchange="renderRecipe()"
                style="width:100%;padding:12px;border-radius:10px;font-size:16px;border:1px solid #bbb;">
            </select>
        </div>

        <!-- ä¸»å…§å®¹ï¼šé£Ÿæ & ç¢³æ’è³‡è¨Š -->
        <div class="section" style="display:flex;gap:30px;">

            <!-- é£Ÿæè¡¨æ ¼ -->
            <div style="flex:1;">
                <h3>ğŸ¥— é£Ÿæåˆ—è¡¨</h3>
                <table>
                    <thead>
                        <tr>
                            <th>é£Ÿæ</th>
                            <th>åŸå§‹é‡</th>
                            <th>é£Ÿææ›ç®—ç¸½é‡é‡(g)</th>
                            <th>CO2e(g)</th>
                        </tr>
                    </thead>
                    <tbody id="ingredientTable"></tbody>
                </table>
            </div>

            <!-- ç¢³æ’è³‡è¨Š -->
            <div style="flex:0.8;">
                <h3>ğŸŒ ç¢³æ’æ”¾åˆ†æ</h3>

                <div style="margin-top:20px;font-size:20px;">
                    æ•´ä»½ï¼š <b id="totalCO2e" style="color:#0b685d;">0 g</b>
                </div>

                <div id="carbonIntensityBox" style="margin-top:20px;"></div>
            </div>
        </div>

    </div>
</div>
<!-- ======================== é—œæ–¼æœ¬å·¥å…·é  ======================== -->
<div id="page_about" class="page">

    <!-- å·¥å…·ä»‹ç´¹ -->
    <div class="section">
        <h2 style="color:#0b675c;">ğŸ“˜ é—œæ–¼é¤µé£Ÿç¢³æ’å°å¹«æ‰‹</h2>

        <p style="font-size:17px;line-height:1.7;">
            æ­¡è¿ä¾†åˆ° <b>é¤µé£Ÿç¢³æ’å°å¹«æ‰‹</b>ï¼  
            é€™è£¡ä¸æ˜¯åš´è‚…çš„ç ”ç©¶å®¤ï¼Œè€Œæ˜¯è®“ä½ ã€Œé¤µé£Ÿã€é£Ÿè­œã€çœ‹çœ‹ä½ çš„æ–™ç†å°åœ°çƒæœ‰å¤šæº«æŸ”çš„å°éŠæ¨‚å ´ ğŸŒğŸ´  
            åªè¦åŒ¯å…¥é£Ÿè­œï¼Œæˆ‘å€‘å°±æœƒç”¨ç°¡å–®çš„æ–¹å¼ç²—ä¼°æ•´ä»½æ–™ç†ç”¢ç”Ÿçš„ç¢³æ’é‡ï¼Œ  
            çœ‹çœ‹å®ƒæ˜¯ã€Œåœ°çƒçš„å¥½æœ‹å‹ã€ï¼Œé‚„æ˜¯ã€Œå·å·æ”¾äº†ä¸€é»å°å£å£çš„ç¢³æ’ã€ğŸ˜†
        </p>

        <p style="margin-top:12px;color:#666;font-size:15px;">
            â€» æœ¬å·¥å…·ç‚ºæ¦‚ç•¥ä¼°è¨ˆï¼Œæ•¸æ“šåƒ…ä¾›åƒè€ƒï¼Œä¸ä»£è¡¨çµ•å°æ•¸å€¼ã€‚
        </p>
    </div>

    <!-- åœ–ç‰‡è¼‰å…¥èªªæ˜ -->
    <div class="section">
        <h3>ğŸ–¼ï¸ åœ–ç‰‡è¼‰å…¥èªªæ˜</h3>
        <p style="line-height:1.7;font-size:16px;">
            è‹¥é£Ÿè­œå°é¢ç„¡æ³•æ­£å¸¸é¡¯ç¤ºï¼Œå¯èƒ½åŸå› å¦‚ä¸‹ï¼š
        </p>

        <ul style="font-size:16px;line-height:1.8;">
            <li>ğŸŒ ä¾†æºç¶²ç«™å¯èƒ½ä¸å…è¨±å¤–éƒ¨æˆªåœ–æœå‹™</li>
            <li>ğŸ½ï¸ é£Ÿè­œæœ¬èº«æ²’æœ‰å°é¢åœ–ç‰‡</li>
            <li>ğŸ“¶ ç¶²è·¯é€£ç·šå•é¡Œæˆ–è¼‰å…¥è¶…æ™‚</li>
        </ul>
    </div>

    <!-- ç¢³æ’ç­‰ç´šèªªæ˜ -->
    <div class="section">
        <h3>ğŸŒ¡ï¸ ç¢³æ’ç­‰ç´šèªªæ˜</h3>

        <ul style="font-size:16px;line-height:1.9;">
            <li>Aï¼ˆVery Lowï¼‰ğŸŒ±ï¼šä½æ–¼ 0.40 kg CO2e</li>
            <li>Bï¼ˆLowï¼‰ğŸ’šï¼š0.40ï½0.89 kg CO2e</li>
            <li>Cï¼ˆMediumï¼‰ğŸƒï¼š0.90ï½1.79 kg CO2e</li>
            <li>Dï¼ˆHighï¼‰ğŸ”¥ï¼š1.80ï½2.59 kg CO2e</li>
            <li>Eï¼ˆVery Highï¼‰ğŸ’¥ï¼šé«˜æ–¼ 2.60 kg CO2e</li>
        </ul>
    </div>

    <!-- æ¨¹æœ¨æ›ç®— -->
    <div class="section">
        <h3>ğŸŒ² æ¨¹æœ¨å¸æ”¶æ›ç®—</h3>
        <p style="line-height:1.8;font-size:16px;">
            ä¸€æ£µæˆç†Ÿå¤§æ¨¹ä¸€å¹´ç´„å¸æ”¶ <b>12 kg</b> çš„ CO2ã€‚<br>
            æ›ç®—æˆæ¯æ—¥å‰‡ç´„ç‚º <b>0.0329 kg</b>ã€‚
        </p>

        <p style="margin-top:10px;font-size:16px;">
            ğŸŒ± æ›ç®—å…¬å¼ï¼š  
            <b>éœ€è¦æ¨¹æœ¨æ£µæ•¸ = é£Ÿè­œ CO2eï¼ˆkgï¼‰ Ã· 0.0329</b>
        </p>
    </div>

    <!-- è»Šè¼›æ›ç®— -->
    <div class="section">
        <h3>ğŸš— æ±½è»Šæ’æ”¾æ›ç®—</h3>

        <p style="line-height:1.8;font-size:16px;">
            ä¸€èˆ¬æ±½è»Šæ¯è¡Œé§› 1 å…¬é‡Œç´„æ’æ”¾ <b>0.244 kg CO2e</b>ã€‚
        </p>

        <p style="margin-top:10px;font-size:16px;">
            ğŸš˜ æ›ç®—å…¬å¼ï¼š  
            <b>ç­‰æ•ˆé–‹è»Šè·é›¢ï¼ˆå…¬é‡Œï¼‰ = é£Ÿè­œ CO2eï¼ˆkgï¼‰ Ã· 0.244</b>
        </p>
    </div>

    <!-- é£Ÿææ›ç®—æ–¹å¼ -->
    <div class="section">
        <h3>ğŸ¥• é£Ÿæå–®ä½æ›ç®—æ–¹å¼</h3>

        <p style="font-size:16px;line-height:1.8;">
            é£Ÿè­œ CSV æœƒæä¾›ï¼š
        </p>

        <ul style="font-size:16px;line-height:1.8;">
            <li><b>unit_value</b>ï¼šæ•¸é‡ï¼ˆå¦‚ 2 æ¯ã€3 æ¹¯åŒ™ï¼‰</li>
            <li><b>weight_grams</b>ï¼šæ¯å–®ä½å°æ‡‰çš„é‡é‡ï¼ˆgï¼‰</li>
        </ul>

        <p style="margin-top:10px;font-size:16px;">
            ğŸ½ï¸ æ›ç®—å…¬å¼ï¼š  
            <b>ç¸½é‡é‡ï¼ˆgï¼‰ï¼ unit_value Ã— weight_grams</b>
        </p>

        <p style="margin-top:10px;font-size:16px;">
            ä¾‹å¦‚ï¼š  
            <b>3 æ¯ Ã— 120 g = 360 g</b>
        </p>
    </div>

</div>
<script>
/* ===========================================================
   âœ¨ SPA é é¢åˆ‡æ›ï¼ˆèˆ‡å°è¦½åˆ—é€£å‹•ï¼‰
=========================================================== */
function showPage(evt, page) {
    // éš±è—æ‰€æœ‰é é¢
    document.querySelectorAll(".page").forEach(p => p.style.display = "none");

    // é¡¯ç¤ºæŒ‡å®šé é¢
    document.getElementById("page_" + page).style.display = "block";

    // åˆ‡æ›å°è¦½åˆ—æ¨£å¼
    document.querySelectorAll(".navItem").forEach(
        n => n.classList.remove("activeTab")
    );
    evt.target.classList.add("activeTab");
}

/* ===========================================================
   âœ¨ CSV è§£æé‚è¼¯
   â€» èˆ‡ä½  MySQL æ­£è¦åŒ–å¾Œçš„è¼¸å‡ºæ¬„ä½å®Œå…¨ç›¸å®¹
=========================================================== */
let allRows = [];
let groupedByID = {};

function loadCSV() {
    let files = document.getElementById("csvFile").files;
    if (files.length === 0) return alert("è«‹é¸æ“‡ CSV æª”æ¡ˆ");

    allRows = [];
    let done = 0;

    Array.from(files).forEach(f => {
        let reader = new FileReader();

        reader.onload = e => {
            parseCSV(e.target.result);
            done++;

            // å…¨éƒ¨è®€å®Œå¾Œæ‰å»ºæ§‹è³‡æ–™
            if (done === files.length) {
                groupByRecipe();
                buildRecipeSelect();
                document.getElementById("mainContent").style.display = "block";
            }
        };

        reader.readAsText(f, "UTF-8");
    });
}

/* ===========================================================
   âœ¨ å°‡ CSV è½‰æˆç‰©ä»¶é™£åˆ—
=========================================================== */
function parseCSV(text) {
    let lines = text.split(/\r?\n/).filter(x => x.trim());
    if (lines.length <= 1) return;

    // è™•ç†è¡¨é ­
    let header = lines[0].split(",").map(h => h.trim().replace("\ufeff", ""));

    // å¾ç¬¬äºŒè¡Œé–‹å§‹è®€å–è³‡æ–™
    for (let i = 1; i < lines.length; i++) {
        let cols = lines[i].split(",");
        if (cols.length < header.length) continue;

        let obj = {};
        header.forEach((h, idx) => {
            obj[h] = cols[idx] ? cols[idx].trim() : "";
        });

        // æ•¸å­—æ¬„ä½ç¢ºä¿ç‚º float
        obj["ingre_total_coe"] = parseFloat(obj["ingre_total_coe"] || "0") || 0;

        allRows.push(obj);
    }
}
/**************************************************************
 * âœ¨ ä¾ recipe_id å°‡é£Ÿæåˆ†çµ„
 **************************************************************/
function groupByRecipe() {
    groupedByID = {};
    allRows.forEach(r => {
        let id = r["recipe_id"];
        if (!groupedByID[id]) groupedByID[id] = [];
        groupedByID[id].push(r);
    });
}

/**************************************************************
 * âœ¨ ç”¢ç”Ÿä¸‹æ‹‰é¸å–®ï¼ˆé£Ÿè­œåˆ—è¡¨ï¼‰
 **************************************************************/
function buildRecipeSelect() {
    let sel = document.getElementById("recipeSelect");
    sel.innerHTML = "";

    Object.keys(groupedByID).forEach(id => {
        let first = groupedByID[id][0];
        sel.innerHTML += `
            <option value="${id}">
                ${first["recipe_name"]} â€” ${first["author"]}
            </option>
        `;
    });

    // é è¨­é¡¯ç¤ºç¬¬ä¸€å€‹é£Ÿè­œ
    renderRecipe();
}

/**************************************************************
 * âœ¨ æœå°‹åŠŸèƒ½ï¼ˆä¾é£Ÿè­œåç¨±æ¨¡ç³ŠåŒ¹é…ï¼‰
 **************************************************************/
function filterRecipes() {
    let kw = document.getElementById("searchInput").value.trim();
    let sel = document.getElementById("recipeSelect");

    sel.innerHTML = "";

    Object.keys(groupedByID).forEach(id => {
        let title = groupedByID[id][0]["recipe_name"];
        if (title.includes(kw)) {
            sel.innerHTML += `<option value="${id}">${title}</option>`;
        }
    });

    if (sel.options.length > 0) renderRecipe();
}
/**************************************************************
 * âœ¨ iCook å°é¢ç¸®åœ–ç”¢ç”Ÿï¼ˆä½¿ç”¨ Thum.ioï¼‰
 **************************************************************/
const cache = {};

function extractCoverImage(url) {
    if (!url) return "";
    if (cache[url]) return cache[url];

    const apiUrl = `https://image.thum.io/get/width/600/${url}`;
    cache[url] = apiUrl;
    return apiUrl;
}

/**************************************************************
 * âœ¨ ç¢³æ’ç­‰ç´šåˆ†é¡ï¼ˆAï½Eï¼‰
 **************************************************************/
function carbonIntensityLevel(kg) {
    if (kg < 0.40) return { level: "A", label: "Very Low", color: "#0f9d58" };
    if (kg < 0.90) return { level: "B", label: "Low", color: "#34a853" };
    if (kg < 1.80) return { level: "C", label: "Medium", color: "#fbbc05" };
    if (kg < 2.60) return { level: "D", label: "High", color: "#ea4335" };
    return { level: "E", label: "Very High", color: "#b80000" };
}

/**************************************************************
 * âœ¨ æ¨¹æœ¨æ›ç®—ï¼ˆkg â†’ æ£µæ•¸ï¼‰
 **************************************************************/
function treesNeededPerDay(kg) {
    return kg / (12 / 365); // 1 æ£µæ¨¹æ¯æ—¥å¸æ”¶ 0.0329 kg
}

/**************************************************************
 * âœ¨ ICON å°ç…§ï¼šAï½E
 **************************************************************/
function earthIcon(level) {
    return {
        "A": "icon_A.png",
        "B": "icon_B.png",
        "C": "icon_C.png",
        "D": "icon_D.png",
        "E": "icon_E.png"
    }[level];
}

/**************************************************************
 * âœ¨ æ¸²æŸ“æ•´ä»½é£Ÿè­œ
 **************************************************************/
function renderRecipe() {
    let id = document.getElementById("recipeSelect").value;
    let rows = groupedByID[id];
    let recipe = rows[0];

    /* =====================
       æ¨™é¡Œå€
    ===================== */
    document.getElementById("recipeTitle").innerText = recipe["recipe_name"];
    document.getElementById("recipeAuthor").innerText = recipe["author"];

    /* =====================
       å°é¢åœ–ç‰‡è™•ç†
    ===================== */
    const fallbackImg = "https://images.unsplash.com/photo-1504674900247-0877df9cc836";
    let cover = extractCoverImage(recipe["recipe_url"]) || fallbackImg;

    const img = document.getElementById("recipeImage");
    const spinner = document.getElementById("imgSpinner");

    spinner.style.display = "block";
    img.style.opacity = "0";
    img.src = fallbackImg;

    let tempImg = new Image();
    let loaded = false;

    tempImg.onload = () => {
        loaded = true;
        spinner.style.display = "none";
        img.src = cover;
        requestAnimationFrame(() => img.style.opacity = "1");
    };

    tempImg.onerror = () => {
        spinner.style.display = "none";
        img.src = fallbackImg;
        img.style.opacity = "1";
    };

    setTimeout(() => {
        if (!loaded) {
            spinner.style.display = "none";
            img.src = fallbackImg;
            img.style.opacity = "1";
        }
    }, 5000);

    tempImg.src = cover;

    /* =====================
       é£Ÿè­œä¾†æºç¶²å€
    ===================== */
    if (recipe["recipe_url"]) {
        document.getElementById("recipeSource").innerHTML = `
            <a href="${recipe["recipe_url"]}" target="_blank"
                style="padding:8px 16px;background:#0fa3a1;color:white;
                       border-radius:10px;text-decoration:none;font-size:15px;
                       box-shadow:0 3px 8px rgba(0,0,0,0.15);">
                ä¾†æºç¶²å€
            </a>
        `;
    } else {
        document.getElementById("recipeSource").innerHTML = "";
    }

    /* =====================
       é£Ÿæè¡¨æ ¼
    ===================== */
    let tbody = document.getElementById("ingredientTable");
    tbody.innerHTML = "";

    let total = 0;

    rows.forEach(r => {
        let uv = parseFloat(r["unit_value"]);
        let wg = parseFloat(r["weight_grams"]);

        // ğŸ”¹ NULL â†’ "-"
        let totalWeight =
            (!isNaN(uv) && !isNaN(wg))
            ? (uv * wg).toFixed(2)
            : "-";

        let co2 = parseFloat(r["ingre_total_coe"]) || 0;
        total += co2;

        tbody.innerHTML += `
            <tr>
                <td>${r["ori_ingredient_name"]}</td>
                <td>${r["unit_value"]} ${r["unit_name"]}</td>
                <td>${totalWeight}</td>
                <td>${co2.toFixed(2)}</td>
            </tr>
        `;
    });

    /* =====================
       æ•´ä»½é£Ÿè­œç¸½ç¢³æ’
    ===================== */
    document.getElementById("totalCO2e").innerText =
        total.toFixed(2) + " g CO2e";

    let kg = total / 1000;
    let ci = carbonIntensityLevel(kg);
    let trees = treesNeededPerDay(kg);
    let km = kg / 0.244;

    let icon = earthIcon(ci.level);

    /* =====================
       ç¢³æ’è³‡è¨Šé¡¯ç¤ºï¼ˆå¯æ„›é¢¨æ ¼ï¼‰
    ===================== */
    document.getElementById("carbonIntensityBox").innerHTML = `
        <div style="
            margin-top:15px;
            padding:20px;
            border-radius:14px;
            background:${ci.color}15;
            border-left:7px solid ${ci.color};
            box-shadow:0 4px 12px rgba(0,0,0,0.12);
        ">

        <div style="display:flex;align-items:center;gap:14px;">
            <img src="${icon}" class="icon-bounce" style="width:48px;height:48px;">
            <div style="font-size:22px;font-weight:700;color:${ci.color}">
                ğŸŒ¡ï¸ Carbon Intensityï¼š${ci.level}ï¼ˆ${ci.label}ï¼‰
            </div>
        </div>

        <div style="font-size:18px;margin-top:14px;color:#333;">
            æ•´ä»½æ’æ”¾ï¼š<b>${kg.toFixed(2)}</b> kg CO2e
        </div>

        <div style="font-size:18px;margin-top:10px;color:#2c3e50;">
            ğŸŒ² éœ€è¦ <b>${trees.toFixed(2)}</b> æ£µæ¨¹ï¼ˆå¸æ”¶ä¸€å¤©ï¼‰
        </div>

        <div style="font-size:18px;margin-top:10px;color:#444;">
            ğŸš— ç›¸ç•¶æ–¼é–‹è»Š <b>${km.toFixed(2)}</b> å…¬é‡Œ
        </div>
    </div>
    `;
}
</script>

</body>
</html>
