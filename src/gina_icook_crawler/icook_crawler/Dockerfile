# ===========================
# ğŸ³  iCook Crawler Dockerfile (Enhanced)
# ===========================
FROM python:3.11-slim

WORKDIR /app

# å®‰è£ç³»çµ±ä¾è³´ï¼ˆç¢ºä¿ bs4/kafka-python ä¸å‡ºç¾ build éŒ¯èª¤ï¼‰
RUN apt-get update && apt-get install -y \
    gcc g++ build-essential libpq-dev curl \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£ Poetryï¼ˆå®˜æ–¹æ¨è–¦æ–¹å¼ï¼‰
RUN curl -sSL https://install.python-poetry.org | python3 -
ENV PATH="/root/.local/bin:$PATH"

# è¤‡è£½å°ˆæ¡ˆè¨­å®šèˆ‡ç¨‹å¼ç¢¼
COPY . .

# å®‰è£æ‰€æœ‰ä¾è³´ï¼ˆåŒ…å« bs4 èˆ‡ kafka-pythonï¼‰
RUN poetry install --no-root && \
    poetry add beautifulsoup4 kafka-python

# å»ºç«‹è³‡æ–™å¤¾ (ç”¨æ–¼ä¿å­˜ CSV / progress.json)
RUN mkdir -p /app/data /app/logs

# é è¨­åŸ·è¡Œ scheduler
CMD ["poetry", "run", "python", "scheduler.py"]

